<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Spin the Wheel</title>
  <style>
    canvas {
      border: 2px solid black;
    }
    #spin {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 18px;
    }
    #result {
      font-size: 20px;
      margin-top: 15px;
    }
  </style>
</head>
<body>

<canvas id="wheelcanvas" width="500" height="500"></canvas><br>
<button id="spin">Spin</button>
<div id="result"></div>

<script>
  const specialNumbers = ["27", "13", "41", "29", "33"];
  const allNumbers = Array.from({ length: 45 }, (_, i) => (i + 1).toString());
  const remainingNumbers = allNumbers.filter(num => !specialNumbers.includes(num));
  const options = [...specialNumbers, ...remainingNumbers];

  const colors = [];
  for (let i = 0; i < options.length; i++) {
    colors.push(`hsl(${(i * 360) / options.length}, 70%, 50%)`);
  }

  let startAngle = 0;
  const arc = Math.PI / (options.length / 2);
  let spinTimeout = null;
  let spinAngleStart = 0;
  let spinTime = 0;
  let spinTimeTotal = 0;
  let finalIndex = 0;

  const ctx = document.getElementById("wheelcanvas").getContext("2d");
  const spinBtn = document.getElementById("spin");
  const resultDiv = document.getElementById("result");

  function weightedRandomIndex() {
    // 50% chance to pick a special number, 50% for others
    if (Math.random() < 0.5) {
      const num = specialNumbers[Math.floor(Math.random() * specialNumbers.length)];
      return options.indexOf(num);
    } else {
      return Math.floor(Math.random() * options.length);
    }
  }

  function drawRouletteWheel() {
    const outsideRadius = 200;
    const textRadius = 160;
    const insideRadius = 125;

    ctx.clearRect(0, 0, 500, 500);
    ctx.strokeStyle = "black";
    ctx.lineWidth = 2;
    ctx.font = 'bold 14px Arial';

    for (let i = 0; i < options.length; i++) {
      const angle = startAngle + i * arc;
      ctx.fillStyle = colors[i];
      ctx.beginPath();
      ctx.arc(250, 250, outsideRadius, angle, angle + arc, false);
      ctx.arc(250, 250, insideRadius, angle + arc, angle, true);
      ctx.stroke();
      ctx.fill();

      ctx.save();
      ctx.fillStyle = "white";
      ctx.translate(250 + Math.cos(angle + arc / 2) * textRadius,
                    250 + Math.sin(angle + arc / 2) * textRadius);
      ctx.rotate(angle + arc / 2);
      const text = options[i];
      ctx.fillText(text, -ctx.measureText(text).width / 2, 0);
      ctx.restore();
    }

    // Arrow
    ctx.fillStyle = "black";
    ctx.beginPath();
    ctx.moveTo(250 - 4, 250 - (outsideRadius + 5));
    ctx.lineTo(250 + 4, 250 - (outsideRadius + 5));
    ctx.lineTo(250 + 4, 250 - (outsideRadius - 5));
    ctx.lineTo(250 + 9, 250 - (outsideRadius - 5));
    ctx.lineTo(250 + 0, 250 - (outsideRadius - 13));
    ctx.lineTo(250 - 9, 250 - (outsideRadius - 5));
    ctx.lineTo(250 - 4, 250 - (outsideRadius - 5));
    ctx.lineTo(250 - 4, 250 - (outsideRadius + 5));
    ctx.fill();
  }

  function rotateWheel() {
    spinTime += 30;
    if (spinTime >= spinTimeTotal) {
      stopRotateWheel();
      return;
    }
    const spinAngle = spinAngleStart * easeOut(spinTime, 0, 1, spinTimeTotal);
    startAngle += spinAngle;
    drawRouletteWheel();
    spinTimeout = setTimeout(rotateWheel, 30);
  }

  function stopRotateWheel() {
    const degrees = startAngle * 180 / Math.PI + 90;
    const arcd = arc * 180 / Math.PI;
    const index = Math.floor((360 - (degrees % 360)) / arcd) % options.length;
    resultDiv.innerHTML = `<h2>You got: ${options[index]}</h2>`;
  }

  function easeOut(t, b, c, d) {
    const ts = (t/=d)*t;
    const tc = ts*t;
    return b + c*(tc + -3*ts + 3*t);
  }

  spinBtn.addEventListener("click", function() {
    finalIndex = weightedRandomIndex();
    const spins = Math.floor(Math.random() * 3) + 5; // random full spins
    const targetAngle = (options.length - finalIndex) * arc; // align with pointer
    const currentRotation = startAngle % (Math.PI * 2);
    let extraRotation = (Math.PI * 2 * spins) + (targetAngle - currentRotation);
    if (extraRotation < 0) extraRotation += Math.PI * 2;

    spinAngleStart = extraRotation / ((Math.random() * 2000 + 4000) / 30);
    spinTime = 0;
    spinTimeTotal = Math.random() * 2000 + 4000;
    rotateWheel();
  });

  drawRouletteWheel();
</script>

</body>
</html>
